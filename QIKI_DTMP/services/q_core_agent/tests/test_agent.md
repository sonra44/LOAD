# СПИСОК ФАЙЛОВ
- services/q_core_agent/tests/test_agent.py

## Вход и цель
[Факт] Модуль содержит unit-тесты для компонентов ядра агента.
[Гипотеза] Цель — регрессия ключевых сценариев обработки тиков и генерации предложений.

## Сбор контекста
[Факт] Тесты используют `pytest`, `unittest.mock`, а также сгенерированные protobuf-модули.
[Факт] Рядом находится пустой `__init__.py` и ядро агента в `services/q_core_agent/core`.
[Гипотеза] Требуются предварительно сгенерированные protobuf классы.

## Локализация артефакта
[Факт] Путь: `services/q_core_agent/tests/test_agent.py`.
[Гипотеза] Запуск через `pytest services/q_core_agent/tests/test_agent.py`.

## Фактический разбор
[Факт] Определены фикстуры `mock_data_provider` и 12 тестовых функций.
[Факт] Проверяются: инициализация `QCoreAgent`, обработка BIOS/FSM ошибок, оценка предложений, логика `RuleEngine`, `NeuralEngine`, `TickOrchestrator`.
[Гипотеза] Тесты предназначены для минимального MVP и могут расширяться.

## Роль в системе и связи
[Факт] Тесты подтверждают корректность взаимодействия компонентов агента.
[Гипотеза] Запуск происходит в CI перед деплоем.

## Несоответствия и риски
- Med: [Гипотеза] зависимость от окружения (protobuf генерация) может ломать запуск.
- High: [Факт] строка "..." в середине файла может случайно прерывать тест.
- Low: [Гипотеза] отсутствуют тесты на негативные входные данные для `NeuralEngine`.

## Мини-патчи (safe-fix)
[Патч] Удалить лишнюю строку "...".
[Патч] Добавить проверки для неверных типов предложений.

## Рефактор-скетч
```python
# пример выделения общих настроек
@pytest.fixture
def agent():
    return QCoreAgent({"test_key": "test_value"})
```

## Примеры использования
```bash
# 1. Запуск всех тестов файла
pytest services/q_core_agent/tests/test_agent.py

# 2. Запуск отдельного теста
pytest services/q_core_agent/tests/test_agent.py::test_qcoreagent_initialization

# 3. Генерация отчёта покрытия
pytest --cov=services.q_core_agent.core -q

# 4. Запуск с выводом логов
pytest -s services/q_core_agent/tests/test_agent.py

# 5. Проверка фикстуры mock_data_provider
python - <<'PY'
from services.q_core_agent.tests.test_agent import mock_data_provider
print(mock_data_provider())
PY
```

## Тест-хуки/чек-лист
- [Факт] `pytest services/q_core_agent/tests/test_agent.py` должен завершаться без ошибок.
- [Гипотеза] Проверять наличие сгенерированных protobuf модулей до запуска.
- [Факт] Проверить покрытие ключевых ветвей `RuleEngine` и `NeuralEngine`.

## Вывод
1. [Факт] Модуль охватывает основные сценарии работы агента.
2. [Патч] Удалить артефакты и расширить проверки.
3. [Гипотеза] Нужен setup окружения с protobuf.
4. [Факт] Тесты используют `pytest` и `Mock`.
5. [Гипотеза] Следует добавить негативные кейсы.
6. [Факт] Наличие фикстур упрощает конфигурацию.
7. [Гипотеза] Можно сгруппировать тесты по подсистемам.
8. [Факт] Примеры демонстрируют запуск и отладку.
9. [Гипотеза] Расширенное покрытие уменьшит регрессии.
10. [Факт] Текущее состояние требует лёгкой чистки.

---
СПИСОК ФАЙЛОВ
- services/q_core_agent/tests/test_agent.py

СПИСОК ФАЙЛОВ
- services/q_core_agent/core/mission_control_terminal.py

## Вход и цель
- [Факт] Разобрать терминал `mission_control_terminal.py` и зафиксировать текущее поведение.
- [Гипотеза] Документ служит основой для будущей доработки интерфейса оператора.

## Сбор контекста
- [Факт] Файл использует `prompt_toolkit`, `ShipCore`, `ShipActuatorController`, `ShipLogicController`.
- [Гипотеза] Соседние файлы `ship_core.py`, `ship_actuators.py`, `test_ship_fsm.py` предоставляют основные API корабля.

## Локализация артефакта
- [Факт] Путь: `services/q_core_agent/core/mission_control_terminal.py`.
- [Факт] Запуск: `python mission_control_terminal.py` в среде Python 3.12 с установленным `prompt_toolkit`.

## Фактический разбор
- [Факт] Класс `MissionControlTerminal` инициирует корабельные контроллеры и запускает поток обновления телеметрии.
- [Факт] Интерфейс строится из панелей: заголовок, телеметрия, двигатель, лог, ввод команд.
- [Гипотеза] Ограничение лога в 50 строках предотвращает переполнение, но может скрыть важные события при долгой работе.

## Роль в системе и связи
- [Факт] Терминал предоставляет оператору доступ к управлению и мониторингу корабля.
- [Гипотеза] Используется как консольный клиент в тестовых сценариях и демонстрациях.

## Несоответствия и риски
- [Факт] При отсутствии `prompt_toolkit` выполняется автоматическая установка через `os.system` (без проверки результата) — риск безопасности (Med).
- [Гипотеза] Нет явных проверок на корректность диапазонов телеметрии — возможны неконтролируемые значения (Low).

## Мини-патчи (safe-fix)
- [Патч] Использовать `subprocess.check_call` для установки `prompt_toolkit` и проверять код возврата.
- [Патч] Ограничить длину `command` перед логированием, чтобы избежать переполнения лога.

## Рефактор-скетч
```python
# [Патч] минимальный пример безопасной установки
try:
    import prompt_toolkit
except ImportError:  # noqa: F401
    import subprocess, sys
    subprocess.check_call([sys.executable, "-m", "pip", "install", "prompt_toolkit"])
```

## Примеры использования
```bash
python mission_control_terminal.py             # [Факт] запуск терминала
```
```bash
python mission_control_terminal.py --help      # [Гипотеза] будущий флаг помощи
```
```python
from core.mission_control_terminal import MissionControlTerminal
MissionControlTerminal().run()                 # [Факт] запуск из кода
```
```bash
pip install prompt_toolkit                     # [Факт] ручная установка зависимостей
```
```bash
CTRL+C                                         # [Факт] завершение работы
```

## Тест-хуки/чек-лист
- [Факт] Юнит: мокнуть `ShipCore` и проверить обновление телеметрии.
- [Факт] Интеграция: симулировать команды `thrust` и `rcs` и оценить реакции.
- [Гипотеза] Нагрузочный: многократный ввод команд для проверки лимитов лога.

## Вывод
- [Факт] Файл реализует насыщенный терминал для управления кораблем.
- [Факт] Основные элементы работают, но установка зависимостей небезопасна.
- [Патч] Добавить безопасный механизм установки и валидацию команд.
- [Гипотеза] В дальнейшем стоит вынести поток обновления в отдельный сервис.
- [Факт] Потребуются тесты на корректность переходов состояний.
- [Факт] Важно документировать протокол команд для операторов.
- [Гипотеза] Возможна интеграция с веб-интерфейсом.
- [Факт] Риск переполнения лога при длительных сессиях.
- [Патч] Стоит добавить ротацию логов.
- [Гипотеза] Интерфейс можно адаптировать под другие миссии.

СПИСОК ФАЙЛОВ
- services/q_core_agent/core/mission_control_terminal.py

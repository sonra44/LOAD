СПИСОК ФАЙЛОВ
- tools/qiki_docgen/core/config.py

## Вход и цель
[Факт] Проанализировать модуль конфигурации `QikiDocgenConfig` и предложить улучшения.

## Сбор контекста
- [Факт] Модуль отвечает за поиск корня проекта и чтение YAML.
- [Факт] Использует простой самописный парсер YAML.
- [Гипотеза] Нужен для работы CLI `qiki_docgen`.

## Локализация артефакта
[Факт] Путь: `tools/qiki_docgen/core/config.py`.
[Гипотеза] Загружается при `from tools.qiki_docgen.core.config import get_config`.

## Фактический разбор
- Класс `QikiDocgenConfig`:
    - [Факт] В конструкторе определяет `config_path` и загружает данные.
    - [Факт] `_find_project_root` ищет директории с маркерами `protos`, `services`, `docs`, `README.md`.
    - [Факт] `_load_config` пытается прочитать YAML или применяет дефолт.
    - [Факт] `_parse_yaml` реализует минимальный разбор строк.
    - [Факт] Методы `get_path`, `get_protoc_includes`, `get` предоставляют доступ к данным.
- Глобальная функция `get_config` предоставляет синглтон.
- Граничные случаи:
    - [Гипотеза] Самописный YAML парсер может некорректно обрабатывать сложные конструкции.
    - [Гипотеза] `_find_project_root` возвращает cwd при отсутствии маркеров, что может быть неверно.

## Роль в системе и связи
- [Факт] Конфигуратор централизует пути и настройки для генератора.
- [Гипотеза] Используется всеми подкомандами CLI.

## Несоответствия и риски
- [Факт] Собственный парсер YAML может не поддерживать списки/вложенность корректно. (High)
- [Факт] Невалидный путь к конфигурации обрабатывается только логом. (Med)
- [Гипотеза] `_find_project_root` может выбрать неверный уровень при наличии нескольких маркеров. (Low)

## Мини-патчи (safe-fix)
- [Патч] Заменить парсер на `yaml.safe_load` из PyYAML.
- [Патч] Явно проверять существование маркеров в `_find_project_root`.
- [Патч] В `get_path` выбрасывать понятное исключение при ошибке.

## Рефактор-скетч
```python
import yaml
class QikiDocgenConfig:
    def _load_config(self):
        self._config_data = yaml.safe_load(self.config_path.read_text())
```

## Примеры использования
```python
# 1. Загрузка конфигурации по умолчанию
from tools.qiki_docgen.core.config import get_config
cfg = get_config()
```
```python
# 2. Получение пути к шаблонам
print(cfg.get_path('templates_dir'))
```
```python
# 3. Список include путей
print(cfg.get_protoc_includes())
```
```python
# 4. Чтение произвольного параметра
print(cfg.get('logging.level'))
```
```bash
# 5. Проверка корня проекта
python - <<'PY'
from tools.qiki_docgen.core.config import QikiDocgenConfig
print(QikiDocgenConfig()._find_project_root())
PY
```

## Тест-хуки/чек-лист
- [Факт] Юнит-тест: `_parse_yaml` корректно читает вложенные структуры.
- [Факт] Тест на отсутствие конфигурационного файла.
- [Гипотеза] Тест на неправильные маркеры проекта.

## Вывод
1. Модуль обеспечивает централизованное управление путями.
2. Самописный парсер повышает риск ошибок.
3. Поиск корня проекта опирается на фиксированные маркеры.
4. Глобальный синглтон упрощает доступ, но усложняет тестирование.
5. Дефолтная конфигурация покрывает базовые пути.
6. Нет обработки сложных YAML конструкций.
7. Путь конфигурации можно переопределить при создании объекта.
8. Метод `get_protoc_includes` фильтрует несуществующие директории.
9. `get` возвращает `default` при отсутствии ключа без логирования.
10. Стоит заменить парсер и усилить проверки корня проекта.

СПИСОК ФАЙЛОВ
- tools/qiki_docgen/core/config.py

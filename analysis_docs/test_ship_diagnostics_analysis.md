## СПИСОК ФАЙЛОВ
- services/q_core_agent/core/test_ship_diagnostics.py

### Вход и цель
Зафиксировать логику теста `test_ship_diagnostics.py`, оценить покрытие и предложить улучшения. Итог: обзор, риски и идеи для модернизации теста.

### Сбор контекста
- [Факт] Файл импортирует `ShipCore` и последовательно вызывает методы статуса.
- [Факт] Запускается как скрипт, возвращая `True/False` для общего статуса.
- [Гипотеза] Используется как ручной диагностический инструмент, а не строгий unit-тест.

### Локализация артефакта
`QIKI_DTMP/services/q_core_agent/core/test_ship_diagnostics.py` — самостоятельный сценарий, может исполняться через `pytest`.

### Фактический разбор
- Инфраструктура: добавляет текущий каталог в `sys.path`.
- Основные шаги: инициализация `ShipCore`, вывод параметров всех подсистем, формирование списка `issues` и итоговое сообщение.
- Возвращает `len(issues) == 0` вместо `assert`, что приводит к предупреждениям в pytest.

### Роль в системе и связи
Обеспечивает базовую проверку конфигурации и статусов корабля. Используется для диагностических прогонов перед запуском FSM.

### Несоответствия и риски
1. Возврат булевого значения вместо утверждений снижает надежность теста (Med).
2. Большое количество `print` затрудняет автоматический анализ (Low).
3. Нет проверок на исключения при чтении конфигурации (Low).

### Мини-патчи (safe-fix)
- [Патч] Заменить `return len(issues) == 0` на `assert not issues`.
- [Патч] Добавить проверки на наличие ключевых секций конфигурации.
- [Патч] Использовать логгер вместо `print` при необходимости логирования.

### Рефактор-скетч (по желанию)
```python
def test_ship_diagnostics():
    ship = ShipCore(base_path=ROOT)
    hull = ship.get_hull_status()
    assert hull.integrity > 0
```

### Примеры использования
1. ```bash
pytest services/q_core_agent/core/test_ship_diagnostics.py -q
```
2. ```bash
python services/q_core_agent/core/test_ship_diagnostics.py
```
3. ```python
from core.ship_core import ShipCore
ship = ShipCore(base_path="./services/q_core_agent")
```
4. ```python
issues = []
# пользовательская логика анализа
```
5. ```bash
python -m pdb services/q_core_agent/core/test_ship_diagnostics.py
```

### Тест-хуки / чек-лист
- Проверка, что тест падает при изменении ключевых параметров конфигурации.
- Проверка обработок исключений конфигурации.

### Вывод
Скрипт выполняет роль расширенного ручного теста, но не полностью соответствует стилю unit-тестов. Важно заменить возвраты на утверждения и добавить проверки ошибок конфигурации. После доработок тест сможет надежно выявлять деградации в подсистемах корабля.
